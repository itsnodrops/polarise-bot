const _0x33e9b2 = _0x2661; function _0x2661(_0x8ba300, _0x5d49a1) { _0x8ba300 = _0x8ba300 - 0xab; const _0x41691a = _0x4169(); let _0x266197 = _0x41691a[_0x8ba300]; return _0x266197; } (function (_0x402be1, _0xb8658) { const _0x2a3ce8 = _0x2661, _0x1f9900 = _0x402be1(); while (!![]) { try { const _0x382068 = -parseInt(_0x2a3ce8(0xe2)) / 0x1 * (parseInt(_0x2a3ce8(0xbe)) / 0x2) + parseInt(_0x2a3ce8(0xd3)) / 0x3 * (-parseInt(_0x2a3ce8(0xb3)) / 0x4) + -parseInt(_0x2a3ce8(0xbf)) / 0x5 * (-parseInt(_0x2a3ce8(0xd9)) / 0x6) + parseInt(_0x2a3ce8(0xac)) / 0x7 * (-parseInt(_0x2a3ce8(0xae)) / 0x8) + parseInt(_0x2a3ce8(0xcd)) / 0x9 + parseInt(_0x2a3ce8(0xc7)) / 0xa + parseInt(_0x2a3ce8(0xc9)) / 0xb * (-parseInt(_0x2a3ce8(0xb2)) / 0xc); if (_0x382068 === _0xb8658) break; else _0x1f9900['push'](_0x1f9900['shift']()); } catch (_0x58e7f0) { _0x1f9900['push'](_0x1f9900['shift']()); } } }(_0x4169, 0x28edd)); import { ethers } from 'ethers'; import { createApiClient } from '../core/api.js'; import { formatAddress, maskSensitive, getAccount, saveAccount, isRegistered } from '../utils/helper.js'; let REF_CODE = _0x33e9b2(0xad); try { const configModule = await import('../../config.js'); REF_CODE = configModule[_0x33e9b2(0xcf)]?.[_0x33e9b2(0xce)] || REF_CODE; } catch (_0x2daa92) { } const POLARISE_RPC = _0x33e9b2(0xd6), POLARISE_CHAIN_ID = 0x5cce; function _0x4169() { const _0x588295 = ['Biz_Id', 'visitAppPage', '2709900KINmaY', 'debug', '264QiCLUP', 'replace', 'getNonce', 'address', '386478HmCGBr', 'REF_CODE', 'default', 'toLowerCase', 'success', 'Account\x20data\x20saved\x20to\x20data/data.json', '1215HKpcrA', 'Error\x20stack:\x20', 'now', 'https://chainrpc.polarise.org', 'accessToken', 'Wallet', '637116QfYPSM', 'Username:\x20', 'Proxy:\x20', 'inviteCode', 'JsonRpcProvider', 'subscription_question', 'auth_token_info', 'auth_token', 'Registration\x20failed:\x20', '7eJRtYK', 'Signing\x20nonce\x20with\x20wallet...', '7uhmPee', 'iZAtsX', '170760OoiIcd', 'Wallet:\x20', 'invite_code', 'polarise', '113808SmPvxQ', '1060yEmDUS', 'Auth\x20token\x20expires\x20in:\x20', 'nonce', 'signMessage', 'toISOString', 'Private\x20key:\x20', 'generateBizId', 'info', 'login', '\x20â†’\x20', '...', '678BGSuqC', '10fBVzID', 'Full\x20address:\x20', 'user_name', 'message', 'none', 'Nonce\x20to\x20confirm:\x20']; _0x4169 = function () { return _0x588295; }; return _0x4169(); } export async function register(_0x33cb12, _0x31ff88 = null, _0x29fe93 = 0x1, _0x6a85a3 = null) { const _0x43e9e8 = _0x33e9b2, _0x265772 = '' + _0x29fe93, _0x3cf7a2 = _0x6a85a3 || { 'info': () => { }, 'warn': () => { }, 'error': () => { }, 'success': () => { }, 'done': () => { }, 'fail': () => { }, 'debug': () => { } }, _0x1bf344 = new ethers[(_0x43e9e8(0xdd))](POLARISE_RPC, { 'chainId': POLARISE_CHAIN_ID, 'name': _0x43e9e8(0xb1) }), _0xc9ebb0 = new ethers[(_0x43e9e8(0xd8))](_0x33cb12, _0x1bf344), _0x47b861 = _0xc9ebb0[_0x43e9e8(0xcc)], _0x3312a4 = getAccount(_0x47b861), _0x48adb0 = isRegistered(_0x47b861); _0x3cf7a2['info'](_0x43e9e8(0xaf) + formatAddress(_0x47b861)), _0x3cf7a2[_0x43e9e8(0xc8)](_0x43e9e8(0xc0) + _0x47b861), _0x3cf7a2[_0x43e9e8(0xc8)](_0x43e9e8(0xb8) + maskSensitive(_0x33cb12, 0x6)), _0x3cf7a2[_0x43e9e8(0xba)](_0x43e9e8(0xdb) + (_0x31ff88 || _0x43e9e8(0xc3))); const _0x93757c = _0x48adb0 ? null : REF_CODE; _0x48adb0 ? _0x3cf7a2['info']('Already\x20registered\x20(Invite\x20Code:\x20' + _0x3312a4[_0x43e9e8(0xdc)] + ')') : _0x3cf7a2[_0x43e9e8(0xba)]('Ref\x20code:\x20' + _0x93757c); const _0x2a1f95 = createApiClient(_0x31ff88, _0x265772); try { await _0x2a1f95[_0x43e9e8(0xc6)](_0x93757c); const _0x371ec7 = await _0x2a1f95[_0x43e9e8(0xb9)](null, _0x47b861, _0x47b861[_0x43e9e8(0xd0)](), _0x43e9e8(0xde)), _0x466b23 = _0x371ec7[_0x43e9e8(0xc5)], _0x49ef08 = await _0x2a1f95[_0x43e9e8(0xcb)](_0x47b861), _0xef1e4f = _0x49ef08[_0x43e9e8(0xb5)]; _0x3cf7a2[_0x43e9e8(0xc8)]('Nonce\x20to\x20sign:\x20' + _0xef1e4f), _0x3cf7a2[_0x43e9e8(0xba)](_0x43e9e8(0xab)); const _0x37a3d5 = _0x43e9e8(0xc4) + _0xef1e4f; _0x3cf7a2[_0x43e9e8(0xc8)]('Message\x20to\x20sign:\x20' + _0x37a3d5['slice'](0x0, 0x3c) + _0x43e9e8(0xbd)); const _0x384669 = await _0xc9ebb0[_0x43e9e8(0xb6)](_0x37a3d5); _0x3cf7a2['debug']('Signature:\x20' + maskSensitive(_0x384669, 0xa)); const _0x5a2a37 = await _0x2a1f95[_0x43e9e8(0xbb)]({ 'signature': _0x384669, 'wallet': _0x47b861, 'nonce': _0xef1e4f, 'subId': _0x466b23, 'inviterCode': _0x93757c || 'null' }), _0x2b8185 = _0x5a2a37['auth_token_info'][_0x43e9e8(0xe0)], _0x3d283a = _0x5a2a37[_0x43e9e8(0xdf)]['expires_in'], _0x59c0d6 = new Date(Date[_0x43e9e8(0xd5)]() + _0x3d283a * 0x3e8)[_0x43e9e8(0xb7)](); _0x3cf7a2[_0x43e9e8(0xc8)]('Auth\x20token:\x20' + maskSensitive(_0x2b8185, 0x14)), _0x3cf7a2[_0x43e9e8(0xc8)](_0x43e9e8(0xb4) + _0x3d283a + 's'); const _0x35918b = await _0x2a1f95['getProfileInfo'](_0x2b8185, _0x47b861); _0x3cf7a2[_0x43e9e8(0xd1)]('Registration\x20complete!'), _0x3cf7a2[_0x43e9e8(0xba)]('User\x20ID:\x20' + _0x35918b['id']), _0x3cf7a2[_0x43e9e8(0xba)](_0x43e9e8(0xda) + _0x35918b['user_name']), _0x3cf7a2[_0x43e9e8(0xba)]('Invite\x20Code:\x20' + _0x35918b[_0x43e9e8(0xb0)]); const _0x4575e3 = saveAccount({ 'wallet': _0x47b861, 'registered': !![], 'userId': _0x35918b['id'], 'userName': _0x35918b[_0x43e9e8(0xc1)], 'inviteCode': _0x35918b[_0x43e9e8(0xb0)], 'bizId': _0x466b23, 'accessToken': _0x2a1f95[_0x43e9e8(0xd7)], 'authToken': _0x2b8185, 'authTokenExpiresIn': _0x3d283a, 'authTokenExpiresAt': _0x59c0d6, 'registeredAt': new Date()[_0x43e9e8(0xb7)]() }); return _0x3cf7a2['debug'](_0x43e9e8(0xd2)), { 'success': !![], 'wallet': _0x47b861, 'userId': _0x35918b['id'], 'userName': _0x35918b[_0x43e9e8(0xc1)], 'inviteCode': _0x35918b['invite_code'], 'authToken': _0x2b8185, 'profile': _0x35918b }; } catch (_0x45b93b) { return _0x3cf7a2['error'](_0x43e9e8(0xe1) + _0x45b93b['message']), _0x3cf7a2[_0x43e9e8(0xc8)](_0x43e9e8(0xd4) + _0x45b93b['stack']?.[_0x43e9e8(0xca)](/\n/g, _0x43e9e8(0xbc))[_0x43e9e8(0xca)](/\s+/g, '\x20')), saveAccount({ 'wallet': _0x47b861, 'registered': ![], 'lastError': _0x45b93b[_0x43e9e8(0xc2)], 'lastAttempt': new Date()[_0x43e9e8(0xb7)]() }), { 'success': ![], 'wallet': _0x47b861, 'error': _0x45b93b[_0x43e9e8(0xc2)] }; } }