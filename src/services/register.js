const _0x31137a = _0x5c06; function _0x5c06(_0x9f6c11, _0x5e6133) { _0x9f6c11 = _0x9f6c11 - 0x197; const _0x4d7d6f = _0x4d7d(); let _0x5c06e4 = _0x4d7d6f[_0x9f6c11]; return _0x5c06e4; } (function (_0x212f03, _0x195247) { const _0x20b004 = _0x5c06, _0x9992dd = _0x212f03(); while (!![]) { try { const _0x3daee4 = -parseInt(_0x20b004(0x1a0)) / 0x1 + parseInt(_0x20b004(0x1ab)) / 0x2 * (-parseInt(_0x20b004(0x1a3)) / 0x3) + -parseInt(_0x20b004(0x1b6)) / 0x4 + parseInt(_0x20b004(0x1b9)) / 0x5 + -parseInt(_0x20b004(0x1ad)) / 0x6 * (parseInt(_0x20b004(0x1c1)) / 0x7) + -parseInt(_0x20b004(0x19c)) / 0x8 + -parseInt(_0x20b004(0x19f)) / 0x9 * (-parseInt(_0x20b004(0x1c2)) / 0xa); if (_0x3daee4 === _0x195247) break; else _0x9992dd['push'](_0x9992dd['shift']()); } catch (_0x2fbc68) { _0x9992dd['push'](_0x9992dd['shift']()); } } }(_0x4d7d, 0x84c9f)); import { ethers } from 'ethers'; import { createApiClient } from '../core/api.js'; import { formatAddress, maskSensitive, getAccount, saveAccount, isRegistered } from '../utils/helper.js'; let REF_CODE = _0x31137a(0x1b7); try { const configModule = await import('../../config.js'); REF_CODE = configModule['default']?.[_0x31137a(0x1c0)] || REF_CODE; } catch (_0x507eee) { } const POLARISE_RPC = 'https://chainrpc.polarise.org', POLARISE_CHAIN_ID = 0x5cce; export async function register(_0x1b9613, _0x59f889 = null, _0x3b027f = 0x1, _0x2a1313 = null) { const _0x14306f = _0x31137a, _0x100071 = '' + _0x3b027f, _0x16f675 = _0x2a1313 || { 'info': () => { }, 'warn': () => { }, 'error': () => { }, 'success': () => { }, 'done': () => { }, 'fail': () => { }, 'debug': () => { } }, _0xfe631c = new ethers[(_0x14306f(0x1a2))](POLARISE_RPC, { 'chainId': POLARISE_CHAIN_ID, 'name': _0x14306f(0x1bf) }), _0xb5f9bf = new ethers[(_0x14306f(0x1a9))](_0x1b9613, _0xfe631c), _0x4a9ec1 = _0xb5f9bf[_0x14306f(0x1c6)], _0xd4a4c4 = getAccount(_0x4a9ec1), _0x10e2cb = isRegistered(_0x4a9ec1); _0x16f675[_0x14306f(0x1b0)](_0x14306f(0x1c5) + formatAddress(_0x4a9ec1)), _0x16f675[_0x14306f(0x1b0)]('Proxy:\x20' + (_0x59f889 || _0x14306f(0x1aa))); const _0x208677 = _0x10e2cb ? null : REF_CODE; _0x10e2cb ? _0x16f675[_0x14306f(0x1b0)](_0x14306f(0x1b3) + _0xd4a4c4['inviteCode'] + ')') : _0x16f675['info'](_0x14306f(0x1be) + _0x208677); const _0x71a8de = createApiClient(_0x59f889, _0x100071); try { await _0x71a8de[_0x14306f(0x1ae)](_0x208677); const _0x11cc18 = await _0x71a8de[_0x14306f(0x1a1)](null, _0x4a9ec1, _0x4a9ec1[_0x14306f(0x1b5)](), _0x14306f(0x198)), _0x3a0ee0 = _0x11cc18['Biz_Id'], _0x3488c8 = await _0x71a8de[_0x14306f(0x1a4)](_0x4a9ec1), _0x1775d4 = _0x3488c8[_0x14306f(0x1c4)]; _0x16f675[_0x14306f(0x1b0)](_0x14306f(0x1a6)); const _0x1334d2 = 'Nonce\x20to\x20confirm:\x20' + _0x1775d4, _0x173d76 = await _0xb5f9bf[_0x14306f(0x1bd)](_0x1334d2), _0x4b4170 = await _0x71a8de[_0x14306f(0x19e)]({ 'signature': _0x173d76, 'wallet': _0x4a9ec1, 'nonce': _0x1775d4, 'subId': _0x3a0ee0, 'inviterCode': _0x208677 || _0x14306f(0x1af) }), _0x27f43d = _0x4b4170[_0x14306f(0x1b4)][_0x14306f(0x1a5)], _0x1e8fc5 = _0x4b4170['auth_token_info'][_0x14306f(0x1c3)], _0x483161 = new Date(Date['now']() + _0x1e8fc5 * 0x3e8)[_0x14306f(0x1b1)](); _0x16f675[_0x14306f(0x1b0)](_0x14306f(0x19b) + _0x1e8fc5 + 's'); const _0x574375 = await _0x71a8de['getProfileInfo'](_0x27f43d, _0x4a9ec1); _0x16f675[_0x14306f(0x1bc)]('Registration\x20complete!'), _0x16f675[_0x14306f(0x1b0)](_0x14306f(0x1bb) + _0x574375['id']), _0x16f675[_0x14306f(0x1b0)](_0x14306f(0x1b8) + _0x574375[_0x14306f(0x199)]), _0x16f675[_0x14306f(0x1b0)]('Invite\x20Code:\x20' + _0x574375[_0x14306f(0x1ac)]); const _0x59d6b3 = saveAccount({ 'wallet': _0x4a9ec1, 'registered': !![], 'userId': _0x574375['id'], 'userName': _0x574375['user_name'], 'inviteCode': _0x574375[_0x14306f(0x1ac)], 'bizId': _0x3a0ee0, 'accessToken': _0x71a8de[_0x14306f(0x1a8)], 'authToken': _0x27f43d, 'authTokenExpiresIn': _0x1e8fc5, 'authTokenExpiresAt': _0x483161, 'registeredAt': new Date()[_0x14306f(0x1b1)]() }); return _0x16f675[_0x14306f(0x197)]('Account\x20data\x20saved\x20to\x20data/data.json'), { 'success': !![], 'wallet': _0x4a9ec1, 'userId': _0x574375['id'], 'userName': _0x574375['user_name'], 'inviteCode': _0x574375[_0x14306f(0x1ac)], 'authToken': _0x27f43d, 'profile': _0x574375 }; } catch (_0x159aaa) { return _0x16f675['error']('Registration\x20failed:\x20' + _0x159aaa[_0x14306f(0x1ba)]), _0x16f675[_0x14306f(0x197)](_0x14306f(0x19d) + _0x159aaa[_0x14306f(0x1a7)]?.[_0x14306f(0x1b2)](/\n/g, _0x14306f(0x19a))[_0x14306f(0x1b2)](/\s+/g, '\x20')), saveAccount({ 'wallet': _0x4a9ec1, 'registered': ![], 'lastError': _0x159aaa['message'], 'lastAttempt': new Date()[_0x14306f(0x1b1)]() }), { 'success': ![], 'wallet': _0x4a9ec1, 'error': _0x159aaa[_0x14306f(0x1ba)] }; } } function _0x4d7d() { const _0x5264d1 = ['2346870WhAOCH', 'message', 'User\x20ID:\x20', 'success', 'signMessage', 'Ref\x20code:\x20', 'polarise', 'REF_CODE', '3409NdrHqT', '1390wXFZDM', 'expires_in', 'nonce', 'Wallet:\x20', 'address', 'debug', 'subscription_question', 'user_name', '\x20â†’\x20', 'Auth\x20token\x20expires\x20in:\x20', '5547472dtxYRU', 'Error\x20stack:\x20', 'login', '203733ATwiEH', '909440eyCnkF', 'generateBizId', 'JsonRpcProvider', '71829dLifmc', 'getNonce', 'auth_token', 'Signing\x20nonce\x20with\x20wallet...', 'stack', 'accessToken', 'Wallet', 'none', '62JXjkvG', 'invite_code', '7146Folsdk', 'visitAppPage', 'null', 'info', 'toISOString', 'replace', 'Already\x20registered\x20(Invite\x20Code:\x20', 'auth_token_info', 'toLowerCase', '587560RRwAsi', 'iZAtsX', 'Username:\x20']; _0x4d7d = function () { return _0x5264d1; }; return _0x4d7d(); }